{% extends "store/base.html" %}
{% load static %}

{% block content %}
<div class="flex justify-between items-center mb-6">
  <h1 class="text-3xl font-bold">Fresh Produce</h1>

  <div class="flex items-center gap-5">
    {# OOS toggle #}
    {% if not show_oos %}
      {% if has_oos %}
        <span class="text-gray-400 cursor-not-allowed">Show out-of-stock</span>
      {% else %}
        <span class="text-gray-400 cursor-not-allowed">Show out-of-stock</span>
      {% endif %}
    {% else %}
      <a href="{% url 'store:catalogue' %}?oos=0{% if show_fav %}&fav=1{% endif %}" class="text-blue-600 underline">Hide out-of-stock</a>
    {% endif %}

    {# Favorites toggle (only useful if signed in) #}
    {% if user.is_authenticated %}
      {% if show_fav %}
        <a href="{% url 'store:catalogue' %}?oos={% if show_oos %}1{% else %}0{% endif %}&fav=0" class="text-blue-600 underline">Hide favorites</a>
      {% else %}
        <a href="{% url 'store:catalogue' %}?oos={% if show_oos %}1{% else %}0{% endif %}&fav=1" class="text-blue-600 underline">Show favorites</a>
      {% endif %}
    {% endif %}
  </div>
</div>

{% for category in categories %}
  <h2 class="text-2xl font-semibold mt-10 mb-4">{{ category.name }}</h2>
  {% if category.description %}
    <p class="mb-4 text-gray-600">{{ category.description }}</p>
  {% endif %}

  <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
    {% for product in category.visible_products %}
      {% include "store/partials/product_card.html" with product=product rem=product.remaining|floatformat:"0" %}
    {% endfor %}
  </div>
{% endfor %}

{# Prevent the weight list popover from being visually clipped by container overflow #}
<style>
  .weight-panel { max-height: none !important; overflow: visible !important; }
</style>

{# IMPORTANT: Load behavior JS INSIDE this content block so it actually renders #}
<script src="{% static 'store/js/fresh_produce.js' %}" defer></script>
{% endblock %}
